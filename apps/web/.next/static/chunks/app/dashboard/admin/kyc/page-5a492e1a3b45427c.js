(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[892,138],{6416:function(e,t,r){Promise.resolve().then(r.bind(r,6658))},6658:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return o}});var s=r(7573),a=r(7653),n=r(1695),i=r(7138),l=r(466),d=r(2196),c=r(7056);function o(){let e=(0,n.useRouter)(),[t,r]=(0,a.useState)(!0),[o,u]=(0,a.useState)([]),[m,f]=(0,a.useState)("pending"),[x,p]=(0,a.useState)(null),[g,v]=(0,a.useState)(null);(0,a.useEffect)(()=>{let t=(0,i.createClient)();(async()=>{try{let{data:{user:r}}=await t.auth.getUser();if(!r){e.push("/auth/login");return}let{data:s}=await t.from("users").select("role").eq("id",r.id).single();if((null==s?void 0:s.role)!=="admin"){e.push("/dashboard");return}await h()}catch(t){console.error("Error:",t),e.push("/auth/login")}finally{r(!1)}})()},[e,m]);let h=async()=>{let e=(0,i.createClient)().from("kyc_documents").select("\n        *,\n        users (\n          first_name,\n          last_name,\n          email\n        )\n      ").order("created_at",{ascending:!1});"all"!==m&&(e=e.eq("status",m));let{data:t,error:r}=await e;r?p(r.message):u(t||[])},b=async(e,t,r)=>{p(null),v(null);let s=(0,i.createClient)(),{data:{user:a}}=await s.auth.getUser();if(!a)return;let{error:n}=await s.from("kyc_documents").update({status:t,reviewed_by:a.id,reviewed_at:new Date().toISOString(),rejection_reason:r||null}).eq("id",e);if(n){p(n.message);return}if("approved"===t){let t=o.find(t=>t.id===e);if(t){let{data:r}=await s.from("kyc_documents").select("status").eq("user_id",t.user_id);(null==r?void 0:r.every(r=>"approved"===r.status||e===t.id))&&await s.from("users").update({kyc_status:"verified"}).eq("id",t.user_id)}}v("Document ".concat(t," successfully")),await h()},j=async e=>{let{data:t}=(0,i.createClient)().storage.from("kyc-documents").getPublicUrl(e);return t.publicUrl};return t?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"text-slate-600",children:"Loading..."})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100",children:[(0,s.jsx)("nav",{className:"bg-white border-b border-slate-200 shadow-sm",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsx)("div",{className:"flex justify-between items-center h-16",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("img",{src:"/logo.png",alt:"PCL Logo",className:"h-10 w-10"}),(0,s.jsx)("h1",{className:"text-2xl font-bold bg-gradient-to-r from-blue-600 to-blue-700 bg-clip-text text-transparent",children:"PCL Admin"})]})})})}),(0,s.jsxs)("main",{className:"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"KYC Document Review"}),(0,s.jsx)("p",{className:"text-slate-600",children:"Review and approve player verification documents"})]}),x&&(0,s.jsx)(c.bZ,{variant:"destructive",className:"mb-4",children:x}),g&&(0,s.jsx)(c.bZ,{variant:"success",className:"mb-4",children:g}),(0,s.jsx)("div",{className:"flex gap-2 mb-6",children:["all","pending","approved","rejected"].map(e=>(0,s.jsxs)(l.z,{variant:m===e?"default":"outline",onClick:()=>f(e),size:"sm",children:[e.charAt(0).toUpperCase()+e.slice(1),"pending"===e&&o.filter(e=>"pending"===e.status).length>0&&(0,s.jsx)("span",{className:"ml-2 bg-red-500 text-white px-2 py-0.5 rounded-full text-xs",children:o.filter(e=>"pending"===e.status).length})]},e))}),(0,s.jsx)("div",{className:"space-y-4",children:0===o.length?(0,s.jsx)(d.Zb,{children:(0,s.jsx)(d.aY,{className:"py-8 text-center text-slate-500",children:"No documents to review"})}):o.map(e=>(0,s.jsxs)(d.Zb,{children:[(0,s.jsx)(d.Ol,{children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(d.ll,{children:[e.users.first_name," ",e.users.last_name]}),(0,s.jsxs)(d.SZ,{children:[e.users.email," â€¢ ",e.document_type.replace(/_/g," ").toUpperCase()]})]}),(0,s.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat("approved"===e.status?"bg-green-100 text-green-800":"rejected"===e.status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:e.status})]})}),(0,s.jsx)(d.aY,{children:(0,s.jsxs)("div",{className:"space-y-4",children:[e.document_number&&(0,s.jsxs)("p",{className:"text-sm text-slate-600",children:["Document Number: ",e.document_number]}),(0,s.jsxs)("p",{className:"text-sm text-slate-500",children:["Submitted: ",new Date(e.created_at).toLocaleDateString()]}),"pending"===e.status&&(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(l.z,{size:"sm",onClick:()=>b(e.id,"approved"),children:"Approve"}),(0,s.jsx)(l.z,{size:"sm",variant:"destructive",onClick:()=>{let t=prompt("Reason for rejection:");t&&b(e.id,"rejected",t)},children:"Reject"}),(0,s.jsx)(l.z,{size:"sm",variant:"outline",onClick:async()=>{let t=await j(e.document_url);window.open(t,"_blank")},children:"View Document"})]})]})})]},e.id))})]})]})}},7056:function(e,t,r){"use strict";r.d(t,{Cd:function(){return c},X:function(){return o},bZ:function(){return d}});var s=r(7573),a=r(7653),n=r(9289),i=r(9147);let l=(0,n.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-red-500/50 text-red-600 dark:border-red-500 [&>svg]:text-red-600",success:"border-green-500/50 text-green-600 dark:border-green-500 [&>svg]:text-green-600",warning:"border-yellow-500/50 text-yellow-600 dark:border-yellow-500 [&>svg]:text-yellow-600"}},defaultVariants:{variant:"default"}}),d=a.forwardRef((e,t)=>{let{className:r,variant:a,...n}=e;return(0,s.jsx)("div",{ref:t,role:"alert",className:(0,i.cn)(l({variant:a}),r),...n})});d.displayName="Alert";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("h5",{ref:t,className:(0,i.cn)("mb-1 font-medium leading-none tracking-tight",r),...a})});c.displayName="AlertTitle";let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,i.cn)("text-sm [&_p]:leading-relaxed",r),...a})});o.displayName="AlertDescription"},466:function(e,t,r){"use strict";r.d(t,{z:function(){return c}});var s=r(7573),a=r(7653),n=r(5814),i=r(9289),l=r(9147);let d=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,t)=>{let{className:r,variant:a,size:i,asChild:c=!1,...o}=e,u=c?n.g7:"button";return(0,s.jsx)(u,{className:(0,l.cn)(d({variant:a,size:i,className:r})),ref:t,...o})});c.displayName="Button"},2196:function(e,t,r){"use strict";r.d(t,{Ol:function(){return l},SZ:function(){return c},Zb:function(){return i},aY:function(){return o},eW:function(){return u},ll:function(){return d}});var s=r(7573),a=r(7653),n=r(9147);let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border border-slate-200 bg-white text-slate-950 shadow-sm dark:border-slate-800 dark:bg-slate-950 dark:text-slate-50",r),...a})});i.displayName="Card";let l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...a})});l.displayName="CardHeader";let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("h2",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",r),...a})});d.displayName="CardTitle";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-slate-500 dark:text-slate-400",r),...a})});c.displayName="CardDescription";let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",r),...a})});o.displayName="CardContent";let u=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",r),...a})});u.displayName="CardFooter"},7138:function(e,t,r){"use strict";r.d(t,{createClient:function(){return a}});var s=r(845);let a=()=>(0,s.createBrowserClient)("https://uvifkmkdoiohqrdbwgzt.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV2aWZrbWtkb2lvaHFyZGJ3Z3p0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYwNTA0MjMsImV4cCI6MjA4MTYyNjQyM30.fbFwh2HBKd4pjImw88hhG4-VuBxWaLDoIpcpZvjHD3o")},9147:function(e,t,r){"use strict";r.d(t,{cn:function(){return n}});var s=r(607),a=r(5579);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,s.W)(t))}},1695:function(e,t,r){"use strict";var s=r(1219);r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})}},function(e){e.O(0,[845,494,293,528,744],function(){return e(e.s=6416)}),_N_E=e.O()}]);