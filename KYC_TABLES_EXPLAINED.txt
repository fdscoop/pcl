# KYC Tables Explained - users vs kyc_documents

## ğŸ¯ Quick Summary

You have TWO different KYC verification systems in your database:

1. **users.kyc_status** (SIMPLE AADHAAR OTP)
   - Quick verification for players
   - Store: kyc_status, kyc_verified_at, aadhaar_number in users table
   - Used by: Players doing quick Aadhaar OTP verification

2. **kyc_documents** table (DOCUMENT UPLOAD)
   - Detailed verification with document uploads
   - Store: Photo, ID, Proof of Address, etc.
   - Used by: Admin review system
   - Currently NOT INTEGRATED in your player flow

---

## ğŸ“Š Table 1: users (KYC Status Fields)

### Purpose
Track Aadhaar-based KYC verification for quick onboarding.

### Relevant Fields
```sql
kyc_status          TEXT       -- 'pending', 'verified', 'rejected'
kyc_verified_at     TIMESTAMP  -- When Aadhaar was verified
aadhaar_number      TEXT       -- Encrypted Aadhaar (12 digits)
```

### How It Works
```
Player Flow:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Player enters: 123456789012        â”‚ (Aadhaar)
â”‚ System generates OTP               â”‚
â”‚ Player enters OTP: 123456          â”‚
â”‚ System verifies                    â”‚
â”‚ Update users.kyc_status='verified' â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Database Update
```typescript
// From: /apps/web/src/app/kyc/verify/page.tsx
supabase
  .from('users')
  .update({
    kyc_status: 'verified',
    kyc_verified_at: new Date().toISOString(),
    aadhaar_number: '123456789012'
  })
  .eq('id', user.id)
```

### Current Status in Your App
âœ… **ACTIVE** - This is what players use daily

---

## ğŸ“„ Table 2: kyc_documents (Document Upload System)

### Purpose
Store uploaded KYC documents (National ID, Passport, Proof of Address, etc.) for admin review.

### Schema
```sql
CREATE TABLE kyc_documents (
  id                UUID PRIMARY KEY,
  user_id           UUID (â†’ users.id),         -- Which player uploaded
  
  -- Document details
  document_type     ENUM,                      -- national_id, passport, etc.
  document_number   TEXT,                      -- ID number, passport number
  document_url      TEXT,                      -- Storage path to file
  
  -- Verification status
  status            TEXT DEFAULT 'pending',    -- pending, approved, rejected
  reviewed_by       UUID,                      -- Admin who reviewed
  reviewed_at       TIMESTAMP,                 -- When admin reviewed
  rejection_reason  TEXT,                      -- Why rejected (if applicable)
  
  -- Extra info
  notes             TEXT,                      -- Admin notes
  expires_at        DATE,                      -- Document expiry
  
  -- Timestamps
  created_at        TIMESTAMP,
  updated_at        TIMESTAMP
)
```

### Document Types Supported
```typescript
enum kyc_document_type {
  'national_id',          // Mandatory
  'passport',             // Optional
  'drivers_license',      // Optional
  'proof_of_address',     // Mandatory
  'birth_certificate',    // Optional
  'other'                 // Optional
}
```

### How It Works (if used)
```
Player Upload Flow:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Player goes to /kyc/upload           â”‚
â”‚ 2. Selects documents (National ID, etc.)â”‚
â”‚ 3. Uploads files to storage             â”‚
â”‚ 4. System creates kyc_documents records â”‚
â”‚    status = 'pending'                   â”‚
â”‚ 5. Admin reviews at /dashboard/admin/kycâ”‚
â”‚ 6. Admin approves/rejects               â”‚
â”‚    status = 'approved' or 'rejected'    â”‚
â”‚ 7. Player sees result                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Storage Location
- **Bucket:** `kyc-documents` (Supabase Storage)
- **File Path Example:** `user-uuid/national_id_1234567890.jpg`
- **Access:** Private (only authenticated users via RLS)

### Current Status in Your App
â³ **PARTIALLY IMPLEMENTED** - Components exist but NOT integrated in player flow:
- Component: `/apps/web/src/components/forms/KYCUploadForm.tsx` (exists but not used)
- Admin Page: `/apps/web/src/app/dashboard/admin/kyc/page.tsx` (exists but not in player workflow)

---

## ğŸ”„ Relationship Between Tables

```
                    users table
                   (SIMPLE KYC)
                    
    kyc_status = 'verified'
    kyc_verified_at = timestamp
    aadhaar_number = '123456789012'
           â”‚
           â”‚ (same user)
           â†“
    kyc_documents table
    (DETAILED DOCUMENTS)
    
    document_type = 'national_id'
    status = 'approved'
    document_url = 'path/to/file.jpg'
```

**Independent systems:**
- `users.kyc_status` works ALONE (quick Aadhaar OTP)
- `kyc_documents` works SEPARATELY (detailed document review)

---

## ğŸ’¡ When to Use Each

### Use users.kyc_status (Simple)
âœ… Fast player onboarding
âœ… Quick verification (< 1 minute)
âœ… Aadhaar OTP based
âœ… Immediate access to features
âœ… For MVP/testing

**Current Implementation:** Using this â† You are here

### Use kyc_documents (Detailed)
âœ… Banks/Financial apps
âœ… Enterprise compliance
âœ… Manual admin review needed
âœ… Multiple document types
âœ… Long-term audit trail
âœ… Complex regulations

**If needed:** For future compliance

---

## ğŸ”‘ Key Fields Reference

### In users Table (Current)
```sql
SELECT 
  id,
  email,
  first_name,
  kyc_status,           â† 'pending', 'verified', or 'rejected'
  kyc_verified_at,      â† 2025-12-20 14:30:00
  aadhaar_number        â† '123456789012'
FROM users
WHERE id = 'player-uuid';
```

### In kyc_documents Table (Not Active)
```sql
SELECT 
  id,
  user_id,
  document_type,        â† 'national_id', 'passport', etc.
  document_number,      â† '123456789012'
  document_url,         â† 'user-uuid/national_id_12345.jpg'
  status,               â† 'pending', 'approved', 'rejected'
  reviewed_by,          â† admin user id
  rejection_reason      â† why it was rejected
FROM kyc_documents
WHERE user_id = 'player-uuid';
```

---

## ğŸ¯ Current Implementation Status

### âœ… Active (In Use)
- users.kyc_status â† MAIN VERIFICATION
- Users can verify with Aadhaar OTP
- Data stored in users table
- Dashboard shows KYC status
- Players become searchable after verification

### â³ Available (Not Integrated)
- kyc_documents table â† SECONDARY SYSTEM
- KYCUploadForm component exists
- Admin dashboard exists
- NOT connected to player flow
- NOT triggered during registration

---

## ğŸš€ What You Have Now

Your current flow (WORKING):

```
User clicks "Start KYC"
    â†“
Enters Aadhaar number
    â†“
System generates OTP (dummy: 123456)
    â†“
Enters OTP
    â†“
users table updated:
  kyc_status = 'verified'
  kyc_verified_at = NOW()
  aadhaar_number = stored
    â†“
players table updated:
  is_available_for_scout = true
    â†“
Player becomes searchable
```

kyc_documents table is **NOT** used in this flow.

---

## ğŸ“‹ Summary

| Aspect | users.kyc_status | kyc_documents |
|--------|------------------|---------------|
| **Purpose** | Quick Aadhaar verification | Detailed document upload |
| **Verification Type** | OTP | Manual admin review |
| **Time to Verify** | < 1 minute | Hours/Days |
| **Data Stored** | Aadhaar, status, timestamp | Documents, files, notes |
| **Storage** | Database | Database + File Storage |
| **Admin Involvement** | None | Yes (review needed) |
| **Current Status** | âœ… ACTIVE | â³ Available |
| **In Your App** | YES (Player uses) | PARTIALLY (Components exist) |
| **Integration** | COMPLETE | NOT INTEGRATED |

---

## â“ FAQ

**Q: Do I need kyc_documents table?**
A: No, for your current MVP. It's optional for future compliance needs.

**Q: Should I delete kyc_documents?**
A: No, leave it. It doesn't affect current flow and provides upgrade path.

**Q: Which one verifies the player?**
A: Currently `users.kyc_status`. The kyc_documents is separate.

**Q: Can I use both together?**
A: Yes, but would need to integrate KYCUploadForm into player flow.

**Q: What's stored in users table for KYC?**
A: kyc_status, kyc_verified_at, aadhaar_number

**Q: What's stored in kyc_documents?**
A: Full documents, file paths, admin notes, review status

---

## ğŸ¬ Next Steps

### Current (Active)
âœ… Keep using users.kyc_status (Aadhaar OTP)
âœ… Players verify with OTP
âœ… Dashboard shows status
âœ… Players become searchable

### Future (Optional)
â³ If you need advanced document handling:
  1. Integrate KYCUploadForm into flow
  2. Create admin dashboard
  3. Set up document review workflow
  4. Update verification logic to check kyc_documents.status

### For Now
- âœ… Your current implementation is CORRECT
- âœ… users table + players table updates work fine
- âœ… kyc_documents is there if you need it later
- âœ… No changes needed

---

**Status:** Current KYC system (Aadhaar OTP) is COMPLETE and WORKING âœ…
